var __spreadArray=this&&this.__spreadArray||function(e,i,l){if(l||arguments.length===2)for(var a=0,t=i.length,r;a<t;a++){if(r||!(a in i)){if(!r)r=Array.prototype.slice.call(i,0,a);r[a]=i[a]}}return e.concat(r||Array.prototype.slice.call(i))};import{T as TranslationController}from"./Translation-7ee0e3b3.js";var CUSTOM_OBJECTS={mappedFieldTypes:{PRIMARY:"TEXT",TEXT:"TEXT",RELATIONSHIP:"RELATIONSHIP",PARAGRAPH:"PARAGRAPH",NUMBER:"NUMBER",DECIMAL:"DECIMAL",DATE:"DATE",DROPDOWN:"DROPDOWN",CHECKBOX:"CHECKBOX",MULTI_SELECT:"MULTI_SELECT"},fieldOrder:["PRIMARY","RELATIONSHIP","TEXT","PARAGRAPH","NUMBER","DECIMAL","DATE","DROPDOWN","CHECKBOX","MULTI_SELECT"],fieldProps:{PRIMARY:{display_label:"fieldTypeText",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"unique",tag:"fieldUniqueTag",display_label:"fieldUnique",info:"fieldUniqueHoverText",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:true}]},RELATIONSHIP:{display_label:"fieldTypeRelationship",description:"fieldTypeRelationshipDesc",link:{label:"fieldTypeRelationshipDescLinkLabel",href:"https://support.freshdesk.com/en/support/solutions/articles/50000004226-understanding-associations"},has_bottom_border:true,checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:false,selected:true}]},TEXT:{display_label:"fieldTypeText",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:true}]},PARAGRAPH:{display_label:"fieldTypeParagraph",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false}]},NUMBER:{display_label:"fieldTypeNumber",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:true}]},DECIMAL:{display_label:"fieldTypeDecimal",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false}]},DATE:{display_label:"fieldTypeDate",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:true}]},DROPDOWN:{display_label:"fieldTypeDropdown",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:true}]},CHECKBOX:{display_label:"fieldTypeCheckbox",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:false}]},MULTI_SELECT:{display_label:"fieldTypeMultiselect",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false},{key:"filterable",tag:"fieldFilterTag",display_label:"fieldFilter",info:"fieldFilterHoverText",enabled:true,selected:true}]}},config:{hasPrimary:true,customizeWidget:true,filterByType:false,editInternalName:false,internalNamePrefix:"",showDefaultTag:false,showDeleteModalInlineMessage:false,showFieldLabelInDeleteModalTitle:true,defaultTagKey:"",defaultTagLabel:"",dropdownFieldWithoutChoicesKey:"",freePlanFieldAddDisabledHeader:"",freePlanFieldAddDisabledMessage:"",freePlanFieldAddDisabledButton:"",noCreatePermissionFieldAddDisabledHeader:"",noCreatePermissionFieldAddDisabledMessage:"",boolShowRelationshipTypeSelect:true,boolShowCustomToggle:false,showCustomToggleField:""},labels:{headerProduct:"",subHeaderProduct:"",dragDropFieldTypes:"fieldTypesDragDrop",fieldTypesHeader:"headerFieldTypes",fieldsHeader:"headerFields",deleteFieldModalHeader:"deleteFieldTitle",deleteFieldModalMessage:"deleteFieldMessage"},maximumLimits:{widgets:{count:5,message:""},fields:{count:100,message:"maximumLimits.fields"},filterable:{count:25,message:"maximumLimits.filterable"},unique:{count:6,message:"maximumLimits.unique"},RELATIONSHIP:{count:5,message:"maximumLimits.lookups"},NUMBER:{count:30,message:"maximumLimits.fields"},CHECKBOX:{count:30,message:"maximumLimits.fields"},DECIMAL:{count:20,message:"maximumLimits.fields"},MULTI_SELECT:{count:20,message:"maximumLimits.fields"},DATE:{count:30,message:"maximumLimits.fields"},TEXT:{count:80,message:"maximumLimits.fields"},PARAGRAPH:{count:10,message:"maximumLimits.fields"},DROPDOWN:{count:30,message:"maximumLimits.fields"},maxLabelChars:{count:255,message:"maximumLimits.maxCharsWarning"},maxInternalNameChars:{count:50,message:"maximumLimits.maxCharsWarning"},maxDropdownChoices:{count:2e3,message:"maximumLimits.maxChoiceOptionsWarning"}}};var CONVERSATION_PROPERTIES={mappedFieldTypes:{TEXT:1,PARAGRAPH:6,NUMBER:8,DECIMAL:13,DATE:17,DROPDOWN:2,CHECKBOX:5,MULTI_SELECT:18,RELATIONSHIP:16,DEPENDENT_FIELD:22},reverseMappedFieldTypes:{1:"TEXT",2:"DROPDOWN",5:"CHECKBOX",6:"PARAGRAPH",8:"NUMBER",13:"DECIMAL",16:"RELATIONSHIP",17:"DATE",18:"MULTI_SELECT",22:"DEPENDENT_FIELD"},fieldOrder:["TEXT","PARAGRAPH","NUMBER","DECIMAL","DATE","DROPDOWN","DEPENDENT_FIELD","CHECKBOX","MULTI_SELECT","RELATIONSHIP"],fieldProps:{TEXT:{display_label:"fieldTypeSingleLineText",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},PARAGRAPH:{display_label:"fieldTypeMultiLineText",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false}]},NUMBER:{display_label:"fieldTypeNumber",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},DECIMAL:{display_label:"fieldTypeDecimal",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},DATE:{display_label:"fieldTypeDate",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},DROPDOWN:{display_label:"fieldTypeDropdown",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},DEPENDENT_FIELD:{display_label:"fieldTypeDependent",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},CHECKBOX:{display_label:"fieldTypeCheckbox",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},MULTI_SELECT:{display_label:"fieldTypeMultiSelectDropdown",checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequiredResolveConv",enabled:true,selected:false}]},RELATIONSHIP:{display_label:"fieldTypeLookupField",has_bottom_border:true,checkboxes:[{key:"required",tag:"fieldRequiredTag",display_label:"fieldRequired",enabled:true,selected:false}]}},config:{hasPrimary:false,customizeWidget:false,filterByType:false,editInternalName:true,internalNamePrefix:"cf_",showDefaultTag:true,showDeleteModalInlineMessage:true,showFieldLabelInDeleteModalTitle:false,defaultTagKey:"custom",defaultTagLabel:"nonCustomDefaultFieldTag",dropdownFieldWithoutChoicesKey:"field_options.reference",freePlanFieldAddDisabledHeader:"freePlanFieldAddDisabledHeader",freePlanFieldAddDisabledMessage:"freePlanFieldAddDisabledMessage",freePlanFieldAddDisabledButton:"freePlanFieldAddDisabledButton",noCreatePermissionFieldAddDisabledHeader:"noCreatePermissionFieldAddDisabledHeader",noCreatePermissionFieldAddDisabledMessage:"noCreatePermissionFieldAddDisabledMessage",boolShowRelationshipTypeSelect:false,boolShowCustomToggle:true,showCustomToggleField:"status"},labels:{headerProduct:"headerProductConvProps",subHeaderProduct:"subHeaderProductConvProps",dragDropFieldTypes:"fieldTypesDragDropConvProps",fieldTypesHeader:"",fieldsHeader:"headerProperties",subHeaderProductLink:{label:"subHeaderProductConvPropsLinkLabel",href:"https://crmsupport.freshworks.com/en/support/solutions/articles/50000005665?cloud=freshchat"},deleteFieldModalHeader:"deleteFieldTitleConversationProp",deleteFieldModalMessage:"deleteFieldMessageConversationProp"},maximumLimits:{widgets:{count:0,message:""},fields:{count:50,message:"maximumLimits.fields"},filterable:{count:0,message:""},unique:{count:0,message:""},NUMBER:{count:20,message:"maximumLimits.fields"},CHECKBOX:{count:30,message:"maximumLimits.fields"},DECIMAL:{count:10,message:"maximumLimits.fields"},MULTI_SELECT:{count:10,message:"maximumLimits.fields"},DATE:{count:30,message:"maximumLimits.fields"},TEXT:{count:50,message:"maximumLimits.fields"},PARAGRAPH:{count:10,message:"maximumLimits.fields"},DROPDOWN:{count:50,message:"maximumLimits.fields"},maxLabelChars:{count:255,message:"maximumLimits.maxCharsWarning"},maxInternalNameChars:{count:47,message:"maximumLimits.maxCharsWarning"},maxDropdownChoices:{count:2e3,message:"maximumLimits.maxChoiceOptionsWarning"},RELATIONSHIP:{count:5,message:"maximumLimits.lookups"},DEPENDENT_FIELD:{count:5e3,message:"maximumLimits.fields"}}};var formMapper={CUSTOM_OBJECTS:CUSTOM_OBJECTS,CONVERSATION_PROPERTIES:CONVERSATION_PROPERTIES};function i18nText(e,i){if(i===void 0){i={}}try{if(e&&i){return TranslationController.t("formBuilder.".concat(e),i)}else if(e){return TranslationController.t("formBuilder.".concat(e))}}catch(l){console.warn("unable to translate ".concat(e," : "),l)}return""}function hasCustomProperty(e,i){if(i&&i!==""&&e&&Object.prototype.hasOwnProperty.call(e,i)){return true}return false}function getNestedKeyValueFromObject(e,i){try{if(!i){return""}return i===null||i===void 0?void 0:i.split(".").reduce((function(e,i){return e?e[i]:undefined}),e)}catch(l){console.error("Error occurred in getNestedKeyValueFromObject: ".concat(l))}return""}function deepCloneObject(e){try{return JSON.parse(JSON.stringify(e))}catch(i){console.log("error deep cloning object - "+i);return{}}}function isPrimaryFieldType(e,i,l,a){if(i===void 0){i="CUSTOM_OBJECTS"}if(l===void 0){l=-1}if(a===void 0){a=true}try{if(i&&i!=="CUSTOM_OBJECTS"){var t=formMapper[i];if(hasCustomProperty(t,"config")&&hasCustomProperty(t.config,"hasPrimary")&&!t.config.hasPrimary){return false}}if(hasCustomProperty(e,"type")&&e.type==="PRIMARY"){return true}if(a&&l===0){return true}}catch(r){console.error("Error occurred in isPrimaryFieldType: ".concat(r))}return false}function isUniqueField(e){try{var i=null;if(hasCustomProperty(e,"field_options")&&hasCustomProperty(e.field_options,"unique")){i=e.field_options.unique;if(i&&(i===true||i==="true")){return true}}}catch(l){}return false}function getMaximumLimitsConfig(e){if(e===void 0){e="CUSTOM_OBJECTS"}try{var i=formMapper[e]["maximumLimits"];return i}catch(l){}return null}function getMaxLimitProperty(e,i){if(e===void 0){e="CUSTOM_OBJECTS"}if(i&&i!==""){try{var l=getMaximumLimitsConfig(e);var a=l===null||l===void 0?void 0:l[i];return a}catch(t){return null}}return null}function getMappedCustomFieldType(e,i){if(e===void 0){e="CUSTOM_OBJECTS"}if(e==="CUSTOM_OBJECTS"){return i}try{var l=formMapper[e];if(hasCustomProperty(l,"mappedFieldTypes")){var a=l["mappedFieldTypes"][i.toString()];return a}}catch(t){}return i}function getFieldTypeCheckboxes(e,i){if(e===void 0){e="CUSTOM_OBJECTS"}try{var l=formMapper[e].fieldProps[i.toString()].checkboxes;if(l&&l.length>0){return deepCloneObject(l)}}catch(a){}return null}function deriveInternalNameFromLabel(e){var i=/[^a-z0-9_]/gi;var l=e&&e.toLowerCase().trim()||"";l=l.replace(/\s+/g,"_").replace(i,"");l=!/^(_+)$/g.test(l)?l:"";return l}function removeFirstOccurrence(e,i){try{if(e&&e!==""&&i&&i!==""){var l=e.indexOf(i);if(l===-1){return e}return e.slice(0,l)+e.slice(l+i.length)}}catch(a){return e}return e}function hasPermission(e,i,l,a){if(a===void 0){a=false}if(i){if(e==="trial"&&l==="EDIT"&&a){return true}else if(e==="trial"||!i.view){return false}else{switch(l){case"CREATE":if(hasCustomProperty(i,"create")&&i.create){return true}break;case"EDIT":if(hasCustomProperty(i,"edit")&&i.edit){return true}break;case"DELETE":if(hasCustomProperty(i,"delete")&&i.delete){return true}break}}}return false}function createUUID(){var e=(new Date).getTime();var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var l=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(i==="x"?l:l&3|8).toString(16)}));return i}function checkIfCustomToggleField(e,i){if(e===void 0){e="CUSTOM_OBJECTS"}var l,a;var t=formMapper[e];return((l=t===null||t===void 0?void 0:t.config)===null||l===void 0?void 0:l.boolShowCustomToggle)&&i===((a=t===null||t===void 0?void 0:t.config)===null||a===void 0?void 0:a.showCustomToggleField)}function getFieldBasedOnLevel(e,i){var l=parseInt(i,10);function a(e,i){if(i===l){return e[0]}if(e&&e[0]&&e[0].fields){return a(e[0].fields,i+1)}return null}return a(e.fields,1)}var validateChoices=function(e,i){return e.find((function(e){return e.value===i}))};var getChoicesById=function(e,i){if(e===void 0){e=[]}if(i===void 0){i=[]}return e.filter((function(e){return i.includes(e.id)}))};var findChoice=function(e,i){return e.find((function(e){return e.id===i}))};var arrFindIndex=function(e,i){return e.findIndex((function(e){return e===i}))};function getDependentLevels(e,i,l,a){var t;if(!a){return{}}var r=e["level_".concat(a)];var d=l.length?l:i.map((function(e){return e.id}));if(r&&d.includes(r)){return e}return Object.assign((t={},t["level_".concat(a)]=d[0],t),e)}function updateFieldAttributes(e,i,l){var a=l.label,t=a===void 0?null:a,r=l.internalName,d=r===void 0?null:r,s=l.name,n=s===void 0?null:s,o=l.choices,u=o===void 0?null:o;if(!i){var c=Object.assign({},e);t&&(c.label=t);n&&(c.name=n);return c}var f=getFieldBasedOnLevel(e,i);if(f){t&&(f["label"]=t);n&&(f["name"]=n);d&&(f["internalName"]=d);u&&u.length&&(f["choices"]=u)}return Object.assign(Object.assign({},e),{fields:e.fields})}function buildChoicesFromText(e,i){var l=e.split("\n");var a=i.fields[0];var t=null;var r=null;l.forEach((function(e){var i=e.trim().replace(/\t/g,"");if(i&&length){if(!e.startsWith("\t")){if(!validateChoices(a.choices,i)){t={id:createUUID(),value:i,dependent_ids:{field:[],choice:[]}};a.choices.push(t)}}else if(e.startsWith("\t")&&!e.startsWith("\t\t")){if(t&&!validateChoices(a.fields[0].choices,i)){r={id:createUUID(),value:i,dependent_ids:{field:[],choice:[]}};var l=a.fields[0];if(!l.id){l.id=createUUID()}t.dependent_ids.choice.push(r.id);if(!t.dependent_ids.field.length){t.dependent_ids.field.push(l.id)}l.choices.push(r)}}else{if(r&&!validateChoices(a.fields[0].fields[0].choices,i)){var l=a.fields[0].fields[0];if(!l.id){l.id=createUUID()}var d={id:createUUID(),value:i,dependent_ids:{choice:[],field:[]}};r.dependent_ids.choice.push(d.id);if(!r.dependent_ids.field.length){r.dependent_ids.field.push(l.id)}a.fields[0].fields[0].choices.push(d)}}}}));return Object.assign(Object.assign({},i),{fields:[a]})}function hasDuplicates(e){var i=new Set;for(var l=0;l<e.length;l++){if(e[l]&&i.has(e[l])){return true}i.add(e[l])}return false}function updateLevelSelection(e,i){var l;if(!e.isDependentField){return}var a=e.dependentLevels;var t=deepCloneObject(a);Object.keys(a).forEach((function(e){if(Number(removeFirstOccurrence(e,"level_"))>i.detail.level){delete t[e]}}));return Object.assign(Object.assign({},t),(l={},l["level_".concat(i.detail.level)]=i.detail.id,l))}function getParentId(e,i,l){if(!i||!e||!e.length){return null}var a=findChoice(e,l["level_".concat(i)]);if(a){return a.id}return e[0].id}function getChildChoices(e,i,l,a){if(!l||!i||!i.length){return{choices:e.choices,ids:[],pid:null}}var t=getParentId(i,l,a);var r=findChoice(i,t);var d=getChoicesById(e.choices,r.dependent_ids.choice);return{ids:r.dependent_ids.choice,choices:d,pId:t}}function updateChoicesInFields(e,i){var l=e.fieldBuilderOptions;var a=i.detail,t=a.level,r=a.parentId,d=a.value,s=a.choice;var n=getFieldBasedOnLevel(l,t);n.choices=d;if(r){var o=parseInt(t,10)-1;var u=getFieldBasedOnLevel(l,o);var c=findChoice(u.choices,r);c.dependent_ids.choice.push(s.id)}return Object.assign(Object.assign({},l),{fields:l.fields})}function deleteChoicesInFields(e,i){var l,a;var t=e.fieldBuilderOptions;var r=i.detail,d=r.level,s=r.parentId,n=r.choice;if(s){var o=parseInt(d,10)-1;var u=getFieldBasedOnLevel(t,o);var c=findChoice(u.choices,s);var f=arrFindIndex(c.dependent_ids.choice,n.id);if(f>-1){c.dependent_ids.choice=__spreadArray(__spreadArray([],c.dependent_ids.choice.slice(0,f),true),c.dependent_ids.choice.slice(f+1),true)}}var m=((a=(l=n.dependent_ids)===null||l===void 0?void 0:l.choice)===null||a===void 0?void 0:a.length)?n.dependent_ids.choice:[];var p=getFieldBasedOnLevel(t,d);p.choices=deepCloneObject(p.choices.filter((function(e){return e.id!==n.id})));var g=function(e,i){var l=parseInt(i,10)+1;var a=getFieldBasedOnLevel(t,l);var r=[];if(a){a.choices=deepCloneObject(a.choices.filter((function(i){if(e.includes(i.id)){r.push.apply(r,i.dependent_ids.choice);return false}return true})))}r.length&&g(r,l)};m.length&&g(m,d);return Object.assign(Object.assign({},t),{fields:t.fields})}function getDefaultDependentLevels(e,i){var l=deepCloneObject(e);function a(e){e.name=removeFirstOccurrence(e.name,i);e.label=e.label||"";if(hasCustomProperty(e,"fields")&&e.fields.length){a(e.fields[0])}}a(l.fields[0]);return Object.assign(Object.assign({},l),{fields:l.fields})}export{getMappedCustomFieldType as a,getMaximumLimitsConfig as b,isPrimaryFieldType as c,deepCloneObject as d,getDefaultDependentLevels as e,hasCustomProperty as f,getFieldTypeCheckboxes as g,hasPermission as h,i18nText as i,isUniqueField as j,formMapper as k,getNestedKeyValueFromObject as l,hasDuplicates as m,checkIfCustomToggleField as n,updateLevelSelection as o,updateChoicesInFields as p,deleteChoicesInFields as q,removeFirstOccurrence as r,buildChoicesFromText as s,deriveInternalNameFromLabel as t,updateFieldAttributes as u,getDependentLevels as v,getMaxLimitProperty as w,getChildChoices as x,createUUID as y};
var __awaiter=this&&this.__awaiter||function(t,e,i,n){function o(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,r){function s(t){try{a(n.next(t))}catch(e){r(e)}}function l(t){try{a(n["throw"](t))}catch(e){r(e)}}function a(t){t.done?i(t.value):o(t.value).then(s,l)}a((n=n.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var i={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,o,r,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(t){return function(e){return a([t,e])}}function a(s){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,o&&(r=s[0]&2?o["return"]:s[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;if(o=0,r)s=[s[0]&2,r.value];switch(s[0]){case 0:case 1:r=s;break;case 4:i.label++;return{value:s[1],done:false};case 5:i.label++;o=s[1];s=[0];continue;case 7:s=i.ops.pop();i.trys.pop();continue;default:if(!(r=i.trys,r=r.length>0&&r[r.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(s[0]===6&&i.label<r[1]){i.label=r[1];r=s;break}if(r&&i.label<r[2]){i.label=r[2];i.ops.push(s);break}if(r[2])i.ops.pop();i.trys.pop();continue}s=e.call(t,i)}catch(l){s=[6,l];o=0}finally{n=r=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,g as getElement}from"./index-f435cf58.js";import{T as TranslationController}from"./Translation-7ee0e3b3.js";import{h as handleKeyDown}from"./utils-06a7316a.js";import{v as v4}from"./v4-86675613.js";import"./index-fb937839.js";var filterCss=':host{font-family:var(--fw-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", roboto, oxygen, ubuntu, cantarell, "Open Sans", "Helvetica Neue", sans-serif);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-box-sizing:border-box;box-sizing:border-box}:host{display:block}.filter{display:block;height:100%}.filter .add-filter{display:inline-block;color:#2c5cc5;line-height:20px;font-weight:600;font-size:14px;cursor:pointer}.filter-action{-webkit-margin-before:12px;margin-block-start:12px}.filter-content{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}';var Filter=function(){function t(t){registerInstance(this,t);this.fwFilterChange=createEvent(this,"fwFilterChange",7);this.identifier=v4();this.sourceFilterOptions=[];this.filterConditions={};this.showSearch=true;this.filters={};this.conditionSchema={}}t.prototype.onSelection=function(t){var e=t.detail,i=e.value,n=e.id,o=e.meta;if(n==="searchDropdown"){var r=o.selectedOptions[0].value;this.filterOptions=this.filterOptions.filter((function(t){return t.value!==i}));var s=this.filters[r].type;if(!s){throw Error("Filter type is not defined for ".concat(r))}else if(!this.conditionSchema[s]){throw Error("Condition schema type is not defined for ".concat(s))}this.filterConditions[r]={};this.filterConditions=Object.assign({},this.filterConditions);t.stopImmediatePropagation();t.stopPropagation();this.showSearch=false}};t.prototype.onConditionDelete=function(t){var e=t.detail.value;delete this.filterConditions[e];this.setFilterOptions(Object.keys(this.filterConditions));this.emitFilterSelection(this.filterConditions);t.stopImmediatePropagation();t.stopPropagation()};t.prototype.onFiltersChange=function(t){this.setFilterOptions(t)};t.prototype.onFilterConditions=function(t){this.emitFilterSelection(t)};t.prototype.getValue=function(){return __awaiter(this,void 0,void 0,(function(){var t,e,i;var n=this;return __generator(this,(function(o){t={};e=Array.from(this.host.shadowRoot.querySelectorAll("fw-filter-condition"));i=e.map((function(e){return e.isValid().then((function(i){if(i){return Promise.resolve(t[e.filterOn]={condition:e.selectedCondition,value:e.valueState})}return Promise.reject("Invalid Filter")}))}));return[2,Promise.all(i).then((function(){var e=n.orderCondition(t);n.saveCurrentState(e);return Promise.resolve(e)})).catch((function(t){return Promise.reject(t)}))]}))}))};t.prototype.clearFilter=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.filterOptions=this.sourceFilterOptions;this.filterConditions={};this.initialFilterConditions={};this.showSearch=true;return[2]}))}))};t.prototype.resetFilter=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.sourceFilterOptions.length>0&&this.loadSavedState();return[2]}))}))};t.prototype.orderCondition=function(t){return Object.keys(this.filterConditions).reduce((function(e,i){e[i]=t[i];return e}),{})};t.prototype.isFiltersAvailable=function(){return this.filterConditions&&Object.keys(this.filterConditions).length>0};t.prototype.setSourceFilterOptions=function(t){this.sourceFilterOptions=Object.keys(t).map((function(e){return Object.assign(Object.assign({},t[e]),{value:e})}))};t.prototype.getDefaultCondition=function(t){return Object.keys(t).filter((function(e){return t[e].default}))[0]};t.prototype.emitFilterSelection=function(t){var e=t?Object.keys(t):[];this.fwFilterChange.emit({filters:e})};t.prototype.setInitialState=function(t){this.initialFilterConditions=Object.assign({},t)||{};this.filterConditions=Object.assign({},this.initialFilterConditions);this.setFilterOptions(this.filterConditions)};t.prototype.saveCurrentState=function(t){this.initialFilterConditions=Object.assign({},t)};t.prototype.loadSavedState=function(){this.filterConditions=Object.assign({},this.initialFilterConditions);this.setFilterOptions(this.filterConditions);this.identifier=v4()};t.prototype.setFilterOptions=function(t){var e=Object.keys(t);if(e.length>0){this.filterOptions=this.sourceFilterOptions.filter((function(t){return!e.includes(t.value)}));this.showSearch=false}else{this.filterOptions=this.sourceFilterOptions;this.showSearch=true}};t.prototype.renderContent=function(t){var e=this;return Object.keys(t).map((function(i){var n=e.filters[i],o=n.text,r=n.type,s=n.controlProps;var l=e.conditionSchema[r];var a=t[i],c=a.value,f=a.condition,u=f===void 0?e.getDefaultCondition(l):f;var p={conditionSchema:l,filterOn:i,filterText:o,controlProps:s,value:c,condition:u,identifier:e.identifier};return h("fw-filter-condition",Object.assign({key:i},p))}))};t.prototype.componentWillLoad=function(){this.setSourceFilterOptions(this.filters);this.setInitialState(this.value)};t.prototype.render=function(){var t=this;return h("div",{class:"filter"},this.isFiltersAvailable()&&h("div",{class:"filter-content"},this.renderContent(this.filterConditions)),h("div",{class:"filter-action"},this.showSearch?h("fw-search-dropdown",{id:"searchDropdown",options:this.filterOptions}):this.filterOptions.length!==0&&h("span",{class:"add-filter",role:"button",tabIndex:0,onClick:function(){t.showSearch=true},onKeyDown:handleKeyDown((function(){t.showSearch=true}))},TranslationController.t("filters.addFilter"))),!this.isFiltersAvailable()&&h("slot",{name:"filter-empty-state"},h("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"}},h("span",null,TranslationController.t("filters.noFilter")))))};Object.defineProperty(t.prototype,"host",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{filters:["onFiltersChange"],filterConditions:["onFilterConditions"]}},enumerable:false,configurable:true});return t}();Filter.style=filterCss;export{Filter as fw_filter};
var __spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++){if(o||!(n in t)){if(!o)o=Array.prototype.slice.call(t,0,n);o[n]=t[n]}}return e.concat(o||Array.prototype.slice.call(t))};import{r as registerInstance,c as createEvent,h,g as getElement,i as Host}from"./index-f435cf58.js";import{d as debounce,c as cloneNodeWithEvents}from"./index-1063dee9.js";var dragElement;var placeholders=[];var DEFAULT_OPTIONS={sortable:false,acceptFrom:"",placeholderClass:"",copy:true,addOnDrop:true};var Draggable=function(){function e(e,t){var r=this;this.childElements=[];this.acceptFrom=[];this.dropped=false;this.debouncedSetElement=debounce((function(e,t,n){if(r.cancelDebouncedDrag){return}var a=r.getDragAfterElement(e,n);var o;if(t.parentElement.id===r.dragContainer.id){o=t}else{r.placeholder||(r.placeholder=r.createPlaceholder(t));o=r.placeholder}r.addElement(o,a)}),this,5);this.onDragStart=function(e){dragElement=e.target;r.dropped=false;r.cancelDebouncedDrag=false;e.dataTransfer.setData("text/plain",dragElement.id);r.childElements=Array.from(r.dragContainer.children);var t=r.childElements.indexOf(dragElement);r.nextSibling=r.childElements[t+1];r.childElements.splice(t,1);e.stopPropagation()};this.onDragEnter=function(e){if(!r.canAcceptDragElement()){return}var t=e.composedPath().find((function(e){return e.id===r.dragContainer.id}));if(t&&t!==r.previousContainer){r.childElements=Array.from(r.dragContainer.children);r.cancelDebouncedDrag=false}r.previousContainer=t};this.onDragLeave=function(e){if(!r.canAcceptDragElement()){return}var t=e.fromElement||e.relatedTarget;if(!e.currentTarget.contains(t)){var n=r.getMatchingHost(t,r.dragContainer.children[0].tagName);if(!e.currentTarget.contains(n)){r.previousContainer=undefined}}};this.onDragOver=function(e){e.preventDefault();if(!r.canAcceptDragElement()){return}r.debouncedSetElement(r.childElements,dragElement,e.clientY)};this.onDragEnd=function(e){if((!r.dropped||placeholders.length>0)&&dragElement){r.addElement(dragElement,r.nextSibling);r.removePlaceholder()}r.resetData(e)};this.onDrop=function(e){if(!r.canAcceptDragElement()){return}r.dropped=true;var t=dragElement.parentElement.id;var n=r.placeholder||dragElement;var a=__spreadArray([],r.dragContainer.children,true).indexOf(n);if(r.placeholder){if(r.options.addOnDrop){var o=r.options.copy?cloneNodeWithEvents(dragElement,true,true):dragElement;r.placeholder.replaceWith(o)}else{r.removePlaceholder()}}r.dragContainer.dispatchEvent(new CustomEvent("fwDropBase",{cancelable:true,bubbles:false,detail:{droppedElement:dragElement,droppedIndex:a,dragFromId:t,dropToId:r.dragContainer.id}}));r.resetData(e)};this.dragContainer=e;this.options=Object.assign({},DEFAULT_OPTIONS,t);this.acceptFrom=this.options.acceptFrom?this.options.acceptFrom.split(","):[];this.options.sortable&&this.acceptFrom.push(this.dragContainer.id);this.addListeners()}e.prototype.addListeners=function(){this.dragContainer.addEventListener("dragstart",this.onDragStart);this.dragContainer.addEventListener("dragend",this.onDragEnd);this.dragContainer.addEventListener("dragenter",this.onDragEnter);this.dragContainer.addEventListener("dragleave",this.onDragLeave);this.dragContainer.addEventListener("dragover",this.onDragOver);this.dragContainer.addEventListener("drop",this.onDrop)};e.prototype.removeListeners=function(){this.dragContainer.removeEventListener("dragstart",this.onDragStart);this.dragContainer.removeEventListener("dragend",this.onDragEnd);this.dragContainer.removeEventListener("dragenter",this.onDragEnter);this.dragContainer.removeEventListener("dragleave",this.onDragLeave);this.dragContainer.removeEventListener("dragover",this.onDragOver);this.dragContainer.removeEventListener("drop",this.onDrop)};e.prototype.getDragAfterElement=function(e,t){return e.reduce((function(e,r){var n=r.getBoundingClientRect();var a=t-n.top-n.height/2;if(a<0&&a>e.offset){return{offset:a,element:r}}else{return e}}),{offset:Number.NEGATIVE_INFINITY}).element};e.prototype.createPlaceholder=function(e){var t;var r=this.options.placeholderClass;var n=this.dragContainer.tagName;var a;if(["UL","OL"].includes(n)){a=document.createElement("li")}else if(["TABLE","TBODY"].includes(n)){a=document.createElement("tr");a.innerHTML='<td colspan="100"></td>'}else{a=document.createElement("div")}if(typeof r==="string"&&r){(t=a.classList).add.apply(t,r.split(" "))}else{a.style.height=this.getElementHeight(e)+"px";a.style.width=this.getElementWidth(e)+"px"}placeholders.push(a);return a};e.prototype.removePlaceholder=function(){placeholders.forEach((function(e){e.remove()}))};e.prototype.addElement=function(e,t){if(t){if(this.canInsertBefore(t)&&!(e===null||e===void 0?void 0:e.isSameNode(t))){this.dragContainer.insertBefore(e,t)}return}this.canAppendTo(this.dragContainer)&&this.dragContainer.appendChild(e)};e.prototype.canAcceptDragElement=function(){if(!dragElement){return false}var e=dragElement.parentElement.id;return this.acceptFrom.includes(e)};e.prototype.canInsertBefore=function(e){return e&&e.pinned!=="top"};e.prototype.canAppendTo=function(e){return e.lastElementChild.pinned!=="bottom"};e.prototype.getHost=function(e){return e.getRootNode().host};e.prototype.getMatchingHost=function(e,t){var r=e;while(r){r=this.getHost(r);if(r&&r.tagName===t){return r}}return undefined};e.prototype.resetData=function(e){e.dataTransfer.clearData();this.previousContainer=undefined;dragElement=undefined;this.placeholder=undefined;this.cancelDebouncedDrag=true};e.prototype.getElementHeight=function(e){if(!(e instanceof HTMLElement)){throw new Error("You must provide a valid dom element")}var t=window.getComputedStyle(e);if(t.getPropertyValue("box-sizing")==="border-box"){return parseInt(t.getPropertyValue("height"),10)}return["height","padding-top","padding-bottom"].map((function(e){var r=parseInt(t.getPropertyValue(e),10);return isNaN(r)?0:r})).reduce((function(e,t){return e+t}))};e.prototype.getElementWidth=function(e){if(!(e instanceof HTMLElement)){throw new Error("You must provide a valid dom element")}var t=window.getComputedStyle(e);return["width","padding-left","padding-right"].map((function(e){var r=parseInt(t.getPropertyValue(e),10);return isNaN(r)?0:r})).reduce((function(e,t){return e+t}))};e.prototype.destroy=function(){this.removeListeners()};return e}();var dragContainerCss=':host{font-family:var(--fw-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", roboto, oxygen, ubuntu, cantarell, "Open Sans", "Helvetica Neue", sans-serif);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-box-sizing:border-box;box-sizing:border-box}.drag-container{display:block}';var DragContainer=function(){function e(e){registerInstance(this,e);this.fwDrop=createEvent(this,"fwDrop",7);this.acceptFrom="";this.addOnDrop=true;this.copy=true;this.placeholderClass="";this.sortable=true}e.prototype.componentWillLoad=function(){this.containerInstance=new Draggable(this.host,{acceptFrom:this.acceptFrom,addOnDrop:this.addOnDrop,copy:this.copy,placeholderClass:this.placeholderClass,sortable:this.sortable});this.host.addEventListener("fwDropBase",this.emitFwDrop.bind(this))};e.prototype.emitFwDrop=function(e){this.fwDrop.emit(e["detail"])};e.prototype.disconnectedCallback=function(){var e;(e=this.containerInstance)===null||e===void 0?void 0:e.destroy();this.host.removeEventListener("fwDropBase",this.emitFwDrop)};e.prototype.render=function(){return h(Host,{class:"drag-container"})};Object.defineProperty(e.prototype,"host",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();DragContainer.style=dragContainerCss;export{DragContainer as fw_drag_container};
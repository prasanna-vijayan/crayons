import{r as t,c as s,h as i,g as e,i as h}from"./p-a21f6813.js";import{d as r,c as o}from"./p-c5b91d96.js";let n;const a=[],d={sortable:!1,acceptFrom:"",placeholderClass:"",copy:!0,addOnDrop:!0};class c{constructor(t,s){this.childElements=[],this.acceptFrom=[],this.dropped=!1,this.debouncedSetElement=r(((t,s,i)=>{if(this.cancelDebouncedDrag)return;const e=this.getDragAfterElement(t,i);let h;s.parentElement.id===this.dragContainer.id?h=s:(this.placeholder||(this.placeholder=this.createPlaceholder(s)),h=this.placeholder),this.addElement(h,e)}),this,5),this.onDragStart=t=>{n=t.target,this.dropped=!1,this.cancelDebouncedDrag=!1,t.dataTransfer.setData("text/plain",n.id),this.childElements=Array.from(this.dragContainer.children);const s=this.childElements.indexOf(n);this.nextSibling=this.childElements[s+1],this.childElements.splice(s,1),t.stopPropagation()},this.onDragEnter=t=>{if(!this.canAcceptDragElement())return;const s=t.composedPath().find((t=>t.id===this.dragContainer.id));s&&s!==this.previousContainer&&(this.childElements=Array.from(this.dragContainer.children),this.cancelDebouncedDrag=!1),this.previousContainer=s},this.onDragLeave=t=>{if(!this.canAcceptDragElement())return;const s=t.fromElement||t.relatedTarget;if(!t.currentTarget.contains(s)){const i=this.getMatchingHost(s,this.dragContainer.children[0].tagName);t.currentTarget.contains(i)||(this.previousContainer=void 0)}},this.onDragOver=t=>{t.preventDefault(),this.canAcceptDragElement()&&this.debouncedSetElement(this.childElements,n,t.clientY)},this.onDragEnd=t=>{(!this.dropped||a.length>0)&&n&&(this.addElement(n,this.nextSibling),this.removePlaceholder()),this.resetData(t)},this.onDrop=t=>{if(!this.canAcceptDragElement())return;this.dropped=!0;const s=n.parentElement.id,i=[...this.dragContainer.children].indexOf(this.placeholder||n);if(this.placeholder)if(this.options.addOnDrop){const t=this.options.copy?o(n,!0,!0):n;this.placeholder.replaceWith(t)}else this.removePlaceholder();this.dragContainer.dispatchEvent(new CustomEvent("fwDropBase",{cancelable:!0,bubbles:!1,detail:{droppedElement:n,droppedIndex:i,dragFromId:s,dropToId:this.dragContainer.id}})),this.resetData(t)},this.dragContainer=t,this.options=Object.assign({},d,s),this.acceptFrom=this.options.acceptFrom?this.options.acceptFrom.split(","):[],this.options.sortable&&this.acceptFrom.push(this.dragContainer.id),this.addListeners()}addListeners(){this.dragContainer.addEventListener("dragstart",this.onDragStart),this.dragContainer.addEventListener("dragend",this.onDragEnd),this.dragContainer.addEventListener("dragenter",this.onDragEnter),this.dragContainer.addEventListener("dragleave",this.onDragLeave),this.dragContainer.addEventListener("dragover",this.onDragOver),this.dragContainer.addEventListener("drop",this.onDrop)}removeListeners(){this.dragContainer.removeEventListener("dragstart",this.onDragStart),this.dragContainer.removeEventListener("dragend",this.onDragEnd),this.dragContainer.removeEventListener("dragenter",this.onDragEnter),this.dragContainer.removeEventListener("dragleave",this.onDragLeave),this.dragContainer.removeEventListener("dragover",this.onDragOver),this.dragContainer.removeEventListener("drop",this.onDrop)}getDragAfterElement(t,s){return t.reduce(((t,i)=>{const e=i.getBoundingClientRect(),h=s-e.top-e.height/2;return h<0&&h>t.offset?{offset:h,element:i}:t}),{offset:Number.NEGATIVE_INFINITY}).element}createPlaceholder(t){const s=this.options.placeholderClass,i=this.dragContainer.tagName;let e;return["UL","OL"].includes(i)?e=document.createElement("li"):["TABLE","TBODY"].includes(i)?(e=document.createElement("tr"),e.innerHTML='<td colspan="100"></td>'):e=document.createElement("div"),"string"==typeof s&&s?e.classList.add(...s.split(" ")):(e.style.height=this.getElementHeight(t)+"px",e.style.width=this.getElementWidth(t)+"px"),a.push(e),e}removePlaceholder(){a.forEach((t=>{t.remove()}))}addElement(t,s){s?this.canInsertBefore(s)&&!(null==t?void 0:t.isSameNode(s))&&this.dragContainer.insertBefore(t,s):this.canAppendTo(this.dragContainer)&&this.dragContainer.appendChild(t)}canAcceptDragElement(){return!!n&&this.acceptFrom.includes(n.parentElement.id)}canInsertBefore(t){return t&&"top"!==t.pinned}canAppendTo(t){return"bottom"!==t.lastElementChild.pinned}getHost(t){return t.getRootNode().host}getMatchingHost(t,s){let i=t;for(;i;)if(i=this.getHost(i),i&&i.tagName===s)return i}resetData(t){t.dataTransfer.clearData(),this.previousContainer=void 0,n=void 0,this.placeholder=void 0,this.cancelDebouncedDrag=!0}getElementHeight(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");const s=window.getComputedStyle(t);return"border-box"===s.getPropertyValue("box-sizing")?parseInt(s.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map((function(t){const i=parseInt(s.getPropertyValue(t),10);return isNaN(i)?0:i})).reduce((function(t,s){return t+s}))}getElementWidth(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");const s=window.getComputedStyle(t);return["width","padding-left","padding-right"].map((function(t){const i=parseInt(s.getPropertyValue(t),10);return isNaN(i)?0:i})).reduce((function(t,s){return t+s}))}destroy(){this.removeListeners()}}const l=class{constructor(i){t(this,i),this.fwDrop=s(this,"fwDrop",7),this.acceptFrom="",this.addOnDrop=!0,this.copy=!0,this.placeholderClass="",this.sortable=!0}componentWillLoad(){this.containerInstance=new c(this.host,{acceptFrom:this.acceptFrom,addOnDrop:this.addOnDrop,copy:this.copy,placeholderClass:this.placeholderClass,sortable:this.sortable}),this.host.addEventListener("fwDropBase",this.emitFwDrop.bind(this))}emitFwDrop(t){this.fwDrop.emit(t.detail)}disconnectedCallback(){var t;null===(t=this.containerInstance)||void 0===t||t.destroy(),this.host.removeEventListener("fwDropBase",this.emitFwDrop)}render(){return i(h,{class:"drag-container"})}get host(){return e(this)}};l.style=':host{font-family:var(--fw-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", roboto, oxygen, ubuntu, cantarell, "Open Sans", "Helvetica Neue", sans-serif);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-box-sizing:border-box;box-sizing:border-box}.drag-container{display:block}';export{l as fw_drag_container}